machine:
  services:
    - docker
  java:
    version: oraclejdk8
  post:
    - sudo service mysql stop
    - sudo service postgresql stop

dependencies:
  override:
    - docker pull behase/relumin-test
    - docker ps -a

test:
  override:
    - docker run -d --net="host" -p 127.0.0.1:9000:9000 -p 127.0.0.1:10000:10000 -p 127.0.0.1:10001:10001 -p 127.0.0.1:10002:10002 -p 127.0.0.1:10003:10003 -p 127.0.0.1:10004:10004 -p 127.0.0.1:10005:10005 -p 127.0.0.1:20000:20000 -p 127.0.0.1:20001:20001 -p 127.0.0.1:20002:20002 -p 127.0.0.1:20003:20003 -p 127.0.0.1:20004:20004 -p 127.0.0.1:20005:20005 -p 127.0.0.1:10010:10010 -p 127.0.0.1:10011:10011 -p 127.0.0.1:10012:10012 -p 127.0.0.1:10013:10013 -p 127.0.0.1:10014:10014 -p 127.0.0.1:10015:10015 behase/relumin-test
    - mvn clean test -DargLine="-Dspring.profiles.active=ci"